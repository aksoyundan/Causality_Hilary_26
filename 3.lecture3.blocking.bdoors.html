<!DOCTYPE html>
<html lang="en"><head>
<script src="3.lecture3.blocking.bdoors_files/libs/clipboard/clipboard.min.js"></script>
<script src="3.lecture3.blocking.bdoors_files/libs/quarto-html/tabby.min.js"></script>
<script src="3.lecture3.blocking.bdoors_files/libs/quarto-html/popper.min.js"></script>
<script src="3.lecture3.blocking.bdoors_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="3.lecture3.blocking.bdoors_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="3.lecture3.blocking.bdoors_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="3.lecture3.blocking.bdoors_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.32">

  <meta name="author" content="Ozan Aksoy">
  <meta name="dcterms.date" content="2026-02-09">
  <title>Blocking backdoors by selection on observables</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="3.lecture3.blocking.bdoors_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="3.lecture3.blocking.bdoors_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="3.lecture3.blocking.bdoors_files/libs/revealjs/dist/theme/quarto-2c1b5f745a11cfad616ebade4a4a7d24.css">
  <link href="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <style>
  .reveal .slide-logo {
    max-height: unset;
    height: 100px;
  }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Blocking backdoors by selection on observables</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Ozan Aksoy 
</div>
</div>
</div>

  <p class="date">February 9, 2026</p>
</section>
<section>
<section id="outline" class="title-slide slide level1 center" data-background-color="#17a091">
<h1>Outline</h1>

</section>
<section id="blocking-backdoor-paths-via-selection-on-observables" class="slide level2">
<h2>Blocking backdoor paths via selection on observables</h2>
<p>Most popular identification strategy: selection on observables, also known as conditional ignorability/independence (stats), unconfoundedness (econ), or conditional exchangeability (epi)</p>
<ul>
<li><p>What is an observational study?</p></li>
<li><p>What is an omitted variable bias?</p></li>
<li><p>What assumptions are required for identification?</p></li>
<li><p>Common estimation methods:</p>
<ol type="1">
<li><p>Regression</p></li>
<li><p>Matching</p></li>
<li><p>Weighting</p></li>
<li><p>Augmented and doubly robust estimators</p></li>
</ol></li>
</ul>
</section></section>
<section>
<section id="observational-studies" class="title-slide slide level1 center" data-background-color="#00a191">
<h1>Observational studies</h1>

</section>
<section id="what-is-an-observational-study" class="slide level2">
<h2>What is an observational study?</h2>
<p>We already discussed the importance of <span style="color:green"><strong>random assignment</strong></span> to justify drawing causal conclusions and conduct statistical inference</p>
<div class="fragment">
<p>Observational data is generated when the treatment of interest is <span style="color:red"><strong>not</strong></span> in control of the researcher (e.g., survey data, administrative records, etc.)</p>
</div>
<div class="fragment">
<p>An observational study is an attempt to use observational data to <span style="color:blue"><em>approximate</em></span> causal conclusions (or, as some would say, “to approximate an experiment”)</p>
</div>
<div class="fragment">
<p>While, in experiments, (conditional) ignorability is justified by design, in observational studies it relies on <span class="fragment fade-in highlight-red">untestable and extra-statistical</span> assumptions</p>
</div>
</section>
<section id="credible-observational-studies" class="slide level2">
<h2>Credible observational studies</h2>
<p>Not all comparisons are created equal!</p>
<div class="fragment">
<p>It is all too common to run some regression analysis and analyse its output as-if a credible <em>causal</em> (“controlled”) comparison can be immediately obtained from the data</p>
</div>
<div class="fragment">
<p>Most times, just recognizing that “our results are not causal” is not enough to prevent a causal interpretation!</p>
</div>
<div class="fragment">
<p><span style="color:green">A credible observational study should be carefully designed to address common issues and rule out alternative explanations</span></p>
</div>
</section>
<section id="credible-observational-studies-1" class="slide level2">
<h2>Credible observational studies</h2>
<p><br></p>
<ul>
<li><p>Assignment is not random, but is it well understood?</p></li>
<li><p>Can we explain why some units that look similar receive different treatments?</p></li>
<li><p>Do we have reliable measures of our variables of interest?</p></li>
<li><p>Does the timing of measurement allow us to order them?</p></li>
<li><p>Can we check “balance” in observable characteristics?</p></li>
<li><p>Can we quantify the influence that unobserved confounding would have on our results?</p></li>
<li><p>Can we rule out alternative explanations to the observed “treatment effect”?</p></li>
</ul>
</section></section>
<section>
<section id="omitted-variable-bias-ovb" class="title-slide slide level1 center" data-background-color="#00a191">
<h1>Omitted variable bias (OVB)</h1>

</section>
<section id="ovb-is-everywhere" class="slide level2">
<h2>OVB is everywhere!</h2>
<div class="r-stack">
<p><img data-src="img/ovb_greta_effect.png" class="fragment"></p>
<p><img data-src="img/ovb_mortality_museums.png" class="fragment"></p>
<p><img data-src="img/ovb_walking.jpg" class="fragment"></p>
<p><img data-src="img/ovb_opioids.jpg" class="fragment" width="750"></p>
</div>
</section>
<section id="the-anatomy-of-ovb" class="slide level2">
<h2>The anatomy of OVB</h2>
</section>
<section id="ovb-structure" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">OVB structure</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div class="left" style="margin-top: 200px;">
<p><span class="math display">\[Y_i \color{white}{=  \alpha + {\beta} X_i + \gamma W_i + \epsilon_i}\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yonly.svg"></p>
</div></div>
</section>
<section id="ovb" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">OVB</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div style="margin-top: 200px;">
<p><span class="math display">\[Y_i =  \alpha \color{white}{+ {\beta} X_i + \gamma W_i + \epsilon_i}\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yonly.svg"></p>
</div></div>
</section>
<section id="ovb-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">OVB</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div style="margin-top: 200px;">
<p><span class="math display">\[Y_i =  \alpha + \color{blue}{\beta} X_i \color{white}{+ \gamma W_i + \epsilon_i}\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yx_beta.svg"></p>
</div></div>
</section>
<section id="ovb-2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">OVB</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div style="margin-top: 200px;">
<p><span class="math display">\[Y_i =  \alpha + \beta X_i \color{white}{+ \gamma W_i + \epsilon_i}\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yxw_beta.svg"></p>
</div></div>
</section>
<section id="ovb-3" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">OVB</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div style="margin-top: 200px;">
<p><span class="math display">\[Y_i =  \alpha + \beta X_i + \color{red}{\gamma} W_i \color{white}{+ \epsilon_i}\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yxw_gamma.svg"></p>
</div></div>
</section>
<section id="ovb-4" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">OVB</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div style="margin-top: 200px;">
<p><span class="math display">\[Y_i =  \alpha + \beta X_i + \color{red}{\gamma} W_i \color{white}{+ \epsilon_i}\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yxw_block.svg"></p>
</div></div>
</section>
<section id="ovb-5" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">OVB</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div style="margin-top: 200px;">
<p><span class="math display">\[Y_i =  \alpha + \beta X_i + \color{red}{\gamma} W_i \color{white}{+ \epsilon_i}\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yxw_block2.svg"></p>
</div></div>
</section>
<section id="ovb-6" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">OVB</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div style="margin-top: 200px;">
<p><span class="math display">\[Y_i =  \alpha + {\beta} X_i + \gamma W_i + \epsilon_i\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yxwe_beta.svg"></p>
</div></div>
<div class="fragment">
<p><span class="math inline">\(\text{corr}(X_i; \epsilon_i) = 0\)</span></p>
</div>
<div class="fragment">
<p><span class="math inline">\(X \rightarrow \dots \leftarrow \epsilon\)</span> is <span class="math inline">\(d-\)</span>separated</p>
</div>
</section>
<section id="ovb-7" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">OVB</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div style="margin-top: 100px;">
<p><span class="math display">\[\color{grey}{Y_i =  \alpha + \beta X_i + \gamma W_i + \epsilon_i}\]</span></p>
<p><span class="math display">\[Y_i =  \zeta + \tilde{\beta} X_i + u_i\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yxu_tilde.svg"></p>
</div></div>
</section>
<section id="ovb-8" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">OVB</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div style="margin-top: 100px;">
<p><span class="math display">\[\color{grey}{Y_i =  \alpha + \beta X_i +  \color{red}{\gamma W_i + \epsilon_i}}\]</span></p>
<p><span class="math display">\[Y_i =  \zeta + \tilde{\beta} X_i + \color{red}{u_i}\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yxu2_tilde.svg"></p>
</div></div>
<div class="fragment">
<p><span class="math inline">\(\text{corr}(X_i ; u_i) \neq 0\)</span></p>
</div>
<div class="fragment">
<p><span class="math inline">\(X \rightarrow u\)</span> is <span class="math inline">\(d-\)</span>connected</p>
</div>
</section>
<section id="the-obv-formula" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">The OBV formula</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div style="margin-top: 100px;">
<p><span class="math display">\[\color{grey}{Y_i =  \zeta + \color{red}{\tilde{\beta}} X_i + u_i}\]</span></p>
<p><span class="math display">\[
\color{red}{\tilde{\beta}} = \frac{\text{Cov}(X_i , Y_i)}{\text{Var}(X_i)}
\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yxu2.svg"></p>
</div></div>
</section>
<section id="the-obv-formula-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">The OBV formula</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div style="margin-top: 100px;">
<p><span class="math display">\[\color{grey}{Y_i =  \zeta + \tilde{\beta} X_i + u_i}\]</span></p>
<p><span class="math display">\[
\tilde{\beta} = \frac{\text{Cov}(X_i , \color{green}{Y_i})}{\text{Var}(X_i)}
\]</span></p>
<p><span class="math display">\[
= \frac{\text{Cov}(X_i, \color{green}{\alpha + \beta X_i + \gamma W_i + \epsilon_i})}{\text{Var}(X_i)}
\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yxu2.svg"></p>
</div></div>
</section>
<section id="the-obv-formula-2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">The OBV formula</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div style="margin-top: 100px;">
<p><span class="math display">\[\color{grey}{Y_i =  \zeta + \tilde{\beta} X_i + u_i}\]</span></p>
<p><span class="math display">\[
\tilde{\beta} = \frac{\text{Cov}(X_i , Y_i)}{\text{Var}(X_i)}
\]</span></p>
<p><span class="math display">\[
= \frac{\color{green}{\text{Cov}(X_i}, \alpha + \color{blue}{\beta} X_i + \color{red}{\gamma} \color{green}{W_i} + \epsilon_i)}{\color{green}{\text{Var}(X_i)}}
\]</span></p>
<p><span class="math display">\[
= \color{blue}{\beta} + \underbrace{\color{red}{\gamma} \times \color{green}{\frac{\text{Cov}(X_i,W_i)}{\text{Var}(X_i)}}}_{\text{Bias}}
\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yxu2.svg"></p>
</div></div>
</section>
<section id="the-obv-formula-3" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">The OBV formula</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div style="margin-top: 100px;">
<p><span class="math display">\[\color{grey}{Y_i =  \zeta + \color{red}{\tilde{\beta}} X_i + u_i}\]</span></p>
<p><span class="math display">\[
\tilde{\beta} = \frac{\text{Cov}(X_i , Y_i)}{\text{Var}(X_i)}
\]</span></p>
<p><span class="math display">\[
= \frac{\text{Cov}(X_i, \alpha + \beta X_i + \gamma W_i + \epsilon_i)}{\text{Var}(X_i)}
\]</span></p>
<p><span class="math display">\[
= \color{blue}{\beta} + \underbrace{\color{red}{\gamma}}_{\text{Impact}} \times \underbrace{\color{green}{\delta}}_{\text{Imbalance}}
\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yxu2.svg"></p>
</div></div>
</section>
<section id="the-obv-formula-4" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">The OBV formula</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong><em>Regression</em></strong></p>
<div style="margin-top: 100px;">
<p><span class="math display">\[\color{grey}{Y_i =  \zeta + \color{red}{\tilde{\beta}} X_i + u_i}\]</span></p>
<p><span class="math display">\[
\tilde{\beta} = \frac{\text{Cov}(X_i , Y_i)}{\text{Var}(X_i)}
\]</span></p>
<p><span class="math display">\[
= \frac{\text{Cov}(X_i, \alpha + \beta X_i + \gamma W_i + \epsilon_i)}{\text{Var}(X_i)}
\]</span></p>
<p><span class="math display">\[
= \color{blue}{\beta} + \underbrace{\color{red}{\gamma}}_{\text{Impact}} \times \underbrace{\color{green}{\delta}}_{\text{Imbalance}}
\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<p><strong><em>Path diagram</em></strong></p>
<p><img data-src="img/dag_yxw_delta.svg"></p>
</div></div>
</section>
<section id="what-to-do" class="slide level2" data-background-color="#00a191">
<h2>What to do?</h2>
</section>
<section id="section" class="slide level2">
<h2></h2>
<p><img data-src="img/ovb_authors.jpg" class="center"></p>
</section></section>
<section>
<section id="unconfoundedness" class="title-slide slide level1 center" data-background-color="#00a191">
<h1>Unconfoundedness</h1>

</section>
<section id="general-setting" class="slide level2">
<h2>General setting</h2>
<p>Let’s assume the following:</p>
<ul>
<li>We observe units <span class="math inline">\(i = 1, \dots, n\)</span></li>
<li>We observe a treatment <span class="math inline">\(D \in {0,1}\)</span></li>
<li>We assume potential outcomes <span class="math inline">\(Y_{di}\)</span> are well defined</li>
</ul>
<div class="fragment">
<p>Our quantity of interest can be (most commonly) the ATE or the ATT</p>
</div>
<div class="fragment">
<p>We have a collection of <span class="math inline">\(k\)</span> <span style="color:blue"><strong>pre-treatment</strong></span> covariates: <span class="math inline">\(X_i = [X_{i1}, \dots , X_{ik}]\)</span></p>
<ul>
<li>Predetermined / causally precede <span class="math inline">\(D_i\)</span></li>
<li>If <span class="math inline">\(X_i\)</span> causes both <span class="math inline">\(D\)</span> and <span class="math inline">\(Y\)</span>, it would <span style="color:red"><em>confound</em></span> the relationship between them</li>
<li>If <span class="math inline">\(X_i\)</span> is potentially affected by <span class="math inline">\(D_i\)</span>, then it may possibly be a <span style="color:red"><em>mediator</em></span>, and it should be handlded with double care</li>
</ul>
<p>More formally: <span class="math inline">\(X\)</span> is a valid adjustment set according to the backdoor criterion</p>
</div>
</section>
<section id="assumptions" class="slide level2">
<h2>Assumptions</h2>
<p>The main assumption in this context is usually referred as unconfoudedness, conditional ignorability, or conditional exhangeability (i.e.&nbsp;backdoor criterion is satisfied by X)</p>
<p>It can be formalized as:</p>
<p><span class="math display">\[
\{Y^T_{i}, Y^C_{i}\} \perp\!\!\!\perp D_i | X_i
\]</span></p>
<div class="callout callout-note no-icon callout-titled callout-style-simple">
<div class="callout-body">
<div class="callout-title">
<p><strong>Read it like this</strong></p>
</div>
<div class="callout-content">
<p>Among units with the same values of <span class="math inline">\(X\)</span>, the treatment <span class="math inline">\(D_i\)</span> is as-good-as randomly assigned</p>
</div>
</div>
</div>
<div class="fragment">
<p>To actually be able to condition by <span class="math inline">\(X\)</span>, we also require positivity (or overlap): the treatment is not deterministic at any relevant value of <span class="math inline">\(X=x\)</span></p>
<p><span class="math display">\[
0 &lt; P(D_i = 1 | X_i) &lt; 1
\]</span></p>
</div>
</section>
<section id="identification-of-ateatt" class="slide level2">
<h2>Identification of ATE/ATT</h2>
<p><strong>Intuition</strong>: Within strata of X, we have an experiment</p>
<p><strong>Proof</strong>: Let’s start with the strata effects <span class="math inline">\(\tau(x)\)</span></p>
<p><span class="math display">\[
\tau(x) = E[Y^T_{i} - Y^C_{i}|X=x] = E[Y^T_{i}|X=x] - E[Y^C_{i}|X=x]  
\]</span> <span class="math display">\[
= E[Y^T_{i}|X=x, D_i=1] - E[Y^C_{i}|X=x, D_i=0]
\]</span></p>
<p><span class="math display">\[
= E[Y_{i}|X=x, D_i=1] - E[Y_{i}|X=x, D_i=0]
\]</span> Then, using the <strong>positivity</strong> or overlap assumption:</p>
<p><span class="math display">\[
ATE = E_x[\tau(x)] = E_x(E[Y^T_{i} - Y^C_{i}|X=x] )
\]</span></p>
<p><span class="math display">\[
= \sum_x \tau(x) p(x)
\]</span></p>
</section>
<section id="in-a-dag-framework" class="slide level2">
<h2>In a DAG framework</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="3.lecture3.blocking.bdoors_files/figure-revealjs/unnamed-chunk-1-1.png" width="384"></p>
</figure>
</div>
</div>
</div>
<p><span class="math display">\[E[Y \mid Do(D=1), Abunchofvariables] - E[Y \mid Do(D=0), Abunchofvariables]\]</span></p>
<p>is identified under the assumptions</p>
<p><span style="color:red"><em>Note:</em></span> As we will see shortly, regression blocks the path <span class="math inline">\(\rightarrow Y\)</span> while matching and weighthing blocks the path <span class="math inline">\(\rightarrow D\)</span>. Blocking any of these paths will identify the “causal” effect of D on Y.</p>
</section></section>
<section>
<section id="estimation" class="title-slide slide level1 center" data-background-color="#00a191">
<h1>Estimation</h1>

</section>
<section id="estimation-overview" class="slide level2">
<h2>Estimation overview</h2>
<p>Under our non-parametric assumptions, the ATE/ATT is identified by the adjustment formula</p>
<p>In practice, different estimators can be used, each incorporate further assumptions</p>
<p>The most widely used estimators are</p>
<ul>
<li>Regression</li>
<li>Matching</li>
<li>Weighting</li>
<li>Augmented estimators</li>
</ul>
<div class="callout callout-note no-icon callout-style-simple">
<div class="callout-body">
<div class="callout-content">
<p>NOTE: none of these estimators are identification strategies. Never say “my results are causal, because I used {matching| weighting | a fancy new estimator of selection on observables}. You buy causality through model assumptions, make those assumptions credible and transparent.”</p>
</div>
</div>
</div>
<p>We will use them in the hands-on exercises of this week</p>
</section></section>
<section>
<section id="modeling-the-outcome-regression" class="title-slide slide level1 center" data-background-color="#E9004C">
<h1>Modeling the outcome: Regression</h1>

</section>
<section id="regression-look-at-the-coefficient" class="slide level2">
<h2>Regression: look at <em>the</em> coefficient!</h2>
<p>In regression we take a model-based approach</p>
<p>For simplicity, let’s assume that the potential outcomes follow certain functional form:</p>
<p><span class="math display">\[
E[Y^D_i|D_i,X_i] = \beta_0 + \beta_1 D_i + \gamma^{\top}X_i
\]</span></p>
<p>Which means that</p>
<p><span class="math inline">\(E[Y^C|X] = E[Y|D=0,X] = \mu_0 = \beta_0 + \gamma^{\top}X_i\)</span></p>
<p><span class="math inline">\(E[Y^T|X] = E[Y|D=1,X] = \mu_1 = \beta_0 + \beta_1 + \gamma^{\top}X_i\)</span></p>
<p>so <span class="math inline">\(\beta_1 = E[Y^T|X] - E[Y^C|X]  = ATE\)</span></p>
<p><span style="color:red;">Side note</span>: subscripts in regression describe what a variable or coefficient varies along, e.g.&nbsp;</p>
<p><span class="math display">\[
Y_{it} = \beta_g + \beta_t + \beta_1 D_{it} + \beta_2 W_i + \epsilon_{it}
\]</span> so intercepts vary by some group (g) and time (t), while D varies by individuals and time W varies only by individuals but is time-constant.</p>
<div class="fragment">
<p>What are we assuming about the treatment effect? What are we assuming about the potential outcomes? Are those assumptions sensible?</p>
</div>
</section>
<section id="the-coefficient-is-a-conditional-variance-weighted-ate-under-effect-heterogeneity" class="slide level2">
<h2><em>The</em> coefficient is a conditional variance weighted ATE under effect heterogeneity</h2>
<table class="caption-top">
<thead>
<tr class="header">
<th>S</th>
<th>P(S, D = 0)</th>
<th>E(Y | S, D = 0)</th>
<th>P(S, D = 1)</th>
<th>E(Y | S, D = 1)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0.36</td>
<td>4</td>
<td>0.08</td>
<td>0</td>
</tr>
<tr class="even">
<td>2</td>
<td>0.12</td>
<td>6</td>
<td>0.12</td>
<td>10</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0.12</td>
<td>10</td>
<td>0.20</td>
<td>12</td>
</tr>
</tbody>
</table>
<p>True ATE: <span class="math inline">\(-4\times(0.36+0.08) + 4\times(0.12+0.12) + 2\times(0.12+0.20) = -.16\)</span></p>
<div class="fragment">
<p>When lm(Y ~ D + as.factor(S)) <span class="math inline">\(\rightarrow \beta_D \approx  0.62^{*}\)</span>!! why?</p>
</div>
<div class="fragment">
<p><font size="6"> <span class="math inline">\(\beta_D\)</span> = <span class="math inline">\(\Delta E[Y|S=1] \frac{var[D|S=1]P[S=1]}{\sum var[D|S=s]P[S=s]} +
\Delta E[Y|S=2] \frac{var[D|S=2]P[S=2]}{\sum var[D|S=s]P[S=s]} +
\Delta E[Y|S=3] \frac{var[D|S=3]P[S=3]}{\sum var[D|S=s]P[S=s]}\)</span> </font></p>
</div>
<div class="fragment">
<p><span class="math inline">\(var[D|S=1] = (\frac{.08}{.08+.36})(1-\frac{.08}{.08+.36})= .15\)</span>, <span class="math inline">\(P[S=1] = .08+.36 = .44\)</span> <span class="math inline">\(var[D|S=2] = (\frac{.12}{.12+.12})(1-\frac{.12}{.12+.12})= .25\)</span>, <span class="math inline">\(P[S=2] = .12+.12 = .24\)</span> <span class="math inline">\(var[D|S=3] = (\frac{.20}{.20+.12})(1-\frac{.20}{.20+.12})= .23\)</span>, <span class="math inline">\(P[S=3] = .12+.20 = .32\)</span></p>
</div>
<div class="fragment">
<p><span class="math inline">\(\beta_D = {\bf -4} \frac{.15 \times .44}{.15 \times .44 + .25 \times .24 + .23 \times .32}
          + {\bf 4} \frac{.25 \times .24}{.15 \times .44 + .25 \times .24 + .23 \times .32}
          + {\bf 2} \frac{.23 \times .32}{.15 \times .44 + .25 \times .24 + .23 \times .32} = 0.62\)</span></p>
</div>
</section>
<section id="beware-that-beta-may-not-always-represent-ate-even-if-causal-assumptions-are-valid" class="slide level2">
<h2>Beware that <span class="math inline">\(\beta\)</span> may not always represent ATE even if causal assumptions are valid</h2>
<ul>
<li><p>When there is heterogeneity in causal effect, beware that <span class="math inline">\(\beta\)</span> is weighted by the conditional variance of treatment</p></li>
<li><p>Those with a lot of variance in treatment represented more strongly in <span class="math inline">\(\beta\)</span></p>
<ul>
<li>E.g. in DID groups which received treatment in the middle of the timeframe rather than start or end</li>
<li>This “rediscovery” of variance weighting sparked the new dynamic DID literature</li>
<li>With continuous and many controls weights going in <span class="math inline">\(\beta\)</span> are even more complex</li>
</ul></li>
<li><p>You <em>could</em> recover true ATE by, e.g., lm(Y ~ D*as.factor(S)) in the example before</p>
<ul>
<li>But when you have too many controls or more than one effect of interest, should you take all interactions?</li>
</ul></li>
</ul>
</section>
<section id="regression-pros-and-cons" class="slide level2">
<h2>Regression: pros and cons</h2>
<p>Pros:</p>
<ul>
<li><p>Everybody loves a regression!</p></li>
<li><p>Easy to interpret</p></li>
<li><p>(Often) transparent</p></li>
<li><p>Flexible (interactions etc. can be added easily)</p></li>
<li><p>Uses variation efficiently</p></li>
</ul>
<p>Cons:</p>
<ul>
<li><p>Restrictive functional form</p></li>
<li><p>Incorrect modeling decisions can ruin the results</p></li>
<li><p>Simplicity can be elusive, sometimes regression can give non-transparent results (e.g.&nbsp;TWFE in diff-in-diff–later…)</p></li>
<li><p><span class="math inline">\(\beta\)</span> is often some strange variance weighted ATE</p></li>
<li><p>We lose interesting variation</p></li>
<li><p>Extrapolation, possibility of non-overlap</p></li>
</ul>
</section>
<section id="regression-extensions-penalised-regression" class="slide level2">
<h2>Regression extensions: penalised regression</h2>
<p>Regression (OLS in particular) finds <span class="math inline">\(\beta\)</span>s in a way that minimises sum of squares between predicted and observed variables, that is:</p>
<p><span class="math display">\[argmin_\beta \{ \sum(Y - \hat{Y})^2\}\]</span></p>
<p>Penalised regressions minimise the same thing <em>plus</em> a function of <span class="math inline">\(\beta\)</span>s:</p>
<p><span class="math display">\[argmin_\beta \{ \sum(Y - \hat{Y})^2 + \lambda F(\beta) \}\]</span></p>
<table class="caption-top">
<thead>
<tr class="header">
<th>Model</th>
<th><span class="math inline">\(F()\)</span></th>
<th><span class="math inline">\(\lambda\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>OLS</td>
<td>NA</td>
<td>0</td>
</tr>
<tr class="even">
<td>LASSO</td>
<td><span class="math inline">\(\sum|\beta|\)</span> (L1-norm)</td>
<td>estimate w cross-validation</td>
</tr>
<tr class="odd">
<td>Ridge</td>
<td><span class="math inline">\(\sum \beta^2\)</span> (L2-norm)</td>
<td>estimate w cross-validation</td>
</tr>
</tbody>
</table>
<p>LASSO/Ridge is for prediction (Machine Learning). But for causal inference, when we have A LOT of potential confounders we can first use LASSO to reduce the dimensionality and then an OLS for the remaining set of control variables. (BEWARE: standardise all variables before LASSO)</p>
</section>
<section id="regression-extensions-use-it-for-imputation" class="slide level2">
<h2>Regression extensions: use it for imputation!</h2>
<p>One way of making use of models that is less sensitive to the specification of a single coefficient is to use the model for imputation.</p>
<ul>
<li><p>Use the model(s) to predict the potential outcomes, and then calculate the difference of interest</p></li>
<li><p>For inference, use the bootstrap</p></li>
</ul>
<p>In epidemiology, this is known as g-computation (“g” stands for “generalized”)</p>
<p>This works well, above and beyond what looking at a single coefficient would give you</p>
<p>Even more, this can be paired with flexible machine learning approaches (e.g.&nbsp;LASSO), going beyond linear regression models (see augmented methods)</p>
</section></section>
<section>
<section id="modeling-the-treatment-assignment" class="title-slide slide level1 center" data-background-color="#E9004C">
<h1>Modeling the treatment assignment</h1>

</section>
<section id="matching" class="slide level2">
<h2>Matching</h2>
<p>For each treated unit <span class="math inline">\(i\)</span> with covariates <span class="math inline">\(X_i\)</span>, we will estimate <span class="math inline">\(\tau_i = Y^T_{i} - Y^C_{i}\)</span></p>
<div class="fragment">
<p>For treated units, we immediately have <span class="math inline">\(Y^T\)</span>. But where do we get <span class="math inline">\(Y^C\)</span> from?</p>
<ul>
<li><strong>Matching</strong>: borrow the missing potential outcomes from control units with (nearly) the same <span class="math inline">\(X_i\)</span> values</li>
</ul>
<p>The estimator is then:</p>
<p><span class="math display">\[
\hat{\tau}_{ATT} = \frac{1}{N_t} \sum_{D=1}(Y_i - Y_{j(i)})
\]</span></p>
<p>Where <span class="math inline">\(Y_{j(i)}\)</span> is the outcome of unit <span class="math inline">\(j\)</span>, which is closest to <span class="math inline">\(i\)</span> in terms of their covariates</p>
</div>
<div class="fragment">
<p>In the simples case, <span class="math inline">\(j\)</span> is a single unit, without replacement. In more complicated versions, it can be an (weighted) average of units that are reused several times</p>
</div>
<div class="fragment">
<div class="callout callout-warning no-icon callout-titled callout-style-simple">
<div class="callout-body">
<div class="callout-title">
<p><strong>But beware of the curse of dimensionality!</strong></p>
</div>
<div class="callout-content">

</div>
</div>
</div>
</div>
</section>
<section id="matching-pros-and-cons" class="slide level2">
<h2>Matching: pros and cons</h2>
<p>Pros:</p>
<ul>
<li><p>Does not rely on linearity or other restrictive assumptions</p></li>
<li><p>Design-based intuition</p></li>
<li><p>Flexible to get different estimands (ATE, ATT, ATC)</p></li>
<li><p>Reduces extrapolation</p></li>
<li><p>Robust to model misspecification</p></li>
<li><p>Clear diagnostics on balance and overlap</p></li>
</ul>
<p>Cons:</p>
<ul>
<li><p>Many different ways to do it, lots of decisions to be made</p></li>
<li><p>Better for discrete (e.g.&nbsp;binary) treatments</p></li>
<li><p>Curse of dimensionality</p></li>
<li><p>Doesn’t work well in longitudinal settings with time varying covariates</p></li>
<li><p>Throws away data</p></li>
</ul>
</section>
<section id="matching-choices-choices" class="slide level2">
<h2>Matching: choices, choices</h2>
<ul>
<li><p>Select variables to match on (confounders that would help block backdoors, avoid mediators! The same as regression)</p></li>
<li><p>Find a way to measure distance between matched treated and control cases</p>
<ul>
<li><p><span style="color:red">Exact matching</span>: a treated unit is matched with control with exact same values on confounders</p></li>
<li><p><span style="color:red">Distance matching</span>: find matches that are not too distant based on a distance metric (e.g.&nbsp;Euclidean Distance or Mahalanobis distance–similar to ED with standardised units); decide on a <em>caliper/bandwidth</em></p></li>
</ul></li>
<li><p>One-to-one or one-to-many matching?</p></li>
<li><p>How to break ties? When two exact control matches for a treatment?</p></li>
<li><p>If one-to-many matches, do we weight better matches more? If so how?</p></li>
<li><p>Matching with or without replacement? The default is the former</p></li>
</ul>
<p>Once you decide all those (!) checking balance between treatment and control and estimating ATE, ATT, or ATC are very easy!</p>
</section>
<section id="weighting" class="slide level2">
<h2>Weighting</h2>
<p>The idea of weighting comes from survey research: how do we get a representative sample?</p>
<p>It is very similar to matching</p>
<div class="fragment">
<ul>
<li>Instead of strata-specific effects that are then reweighted by <span class="math inline">\(X\)</span>, make <span class="math inline">\(X\)</span> look similar across groups and then take a simple average!</li>
</ul>
</div>
<div class="fragment">
<p>Recall that the difference-in-means can be viewed as:</p>
<p><span class="math display">\[
\sum_x E[Y_i | D=1, X]\color{red}{P(X|D=1)} - \sum_x E[Y_i | D=0, X]\color{red}{P(X|D=0)}
\]</span></p>
<p><span style="color:red">How to solve the discrepancy in the weights?</span></p>
</div>
<div class="fragment">
<p>We want the weights of the diff-in-means to be <span class="math inline">\(P(X)\)</span> for everyone, so we can re-weight by <span class="math inline">\(\frac{P(D_i)}{P(D_i|X_i)}\)</span> (but, note that this requires a model for <span class="math inline">\(P(D_i|X_i)\)</span>!)</p>
</div>
</section>
<section id="weighting-pros-and-cons" class="slide level2">
<h2>Weighting: pros and cons</h2>
<p>Pros:</p>
<ul>
<li><p>Uses all data</p></li>
<li><p>Conceptually clean</p></li>
<li><p>Can work with post-treatment variables (under sequential ignorability)</p></li>
<li><p>Handles many covariates easily</p></li>
</ul>
<p>Cons:</p>
<ul>
<li><p>Extreme weights can mess things up</p></li>
<li><p>High variance</p></li>
<li><p>Sensitive to selection modeling choices</p></li>
<li><p>Not intuitive</p></li>
<li><p>Not familiar</p></li>
</ul>
</section>
<section id="how-to-weight-propensity-scores" class="slide level2">
<h2>How to weight: propensity scores</h2>
<p><em>(Stabilized or trimmed) propensity score weights</em> can be used for weighting. Other names for the same object are <em>inverse probability of the treatment weighting</em> or simply <em>inverse probability weighting</em> (IPW)</p>
<p>Those weights require estimating a model for the treatment assignment <span class="math inline">\(P(D_i|X_i)\)</span>. In other words, they require we fit a <span style="color:blue"><em>propensity score</em></span> model, <span class="math inline">\(P(D_i=1|X_i) = e(X_i)\)</span> (or <span class="math inline">\(\pi(X_i)\)</span>)</p>
<div class="fragment">
<p>Using propensity score for weighting is based on a simple but powerful result. If:</p>
<p><span class="math display">\[
\{Y_1,Y_0\} \perp\!\!\!\perp D_i | X_i
\]</span> Then,</p>
<p><span class="math display">\[
\{Y_1,Y_0\} \perp\!\!\!\perp D_i | e(X_i)
\]</span></p>
</div>
<div class="fragment">
<p>The propensity score is a <span style="color:green"><em>balancing score</em></span>, that will achieve balance in the variables used to estimate the propensity score, <span style="color:red"><em>in expectation</em></span></p>
<p>NB: Propensity score <em>matching</em> an old practice is not advised anymore, but PS <em>weighting</em> is (currently) safe</p>
</div>
</section>
<section id="propensity-score-weights" class="slide level2">
<h2>Propensity score weights</h2>
<p>For the ATE, the corresponding IPWs are:</p>
<p><span class="math display">\[
w_i = \frac{D_i}{e(X_i)} + \frac{1-D_i}{1-e(X_i)}
\]</span></p>
<div class="fragment">
<ul>
<li>What would this weights do for the treated units? And for the controls?</li>
</ul>
<p>With these weights, IPW estimator is simply:</p>
<p><span class="math display">\[
\widehat{\mathrm{ATE}}_{\mathrm{IPW}}
=
\frac{1}{n}\sum_{i=1}^n
\left(
\frac{D_i Y_i}{\hat e(X_i)}
-
\frac{(1-D_i) Y_i}{1-\hat e(X_i)}
\right)
=
\frac{1}{n}\sum_{i=1}^n
(Y_i w_i)
\]</span></p>
<ul>
<li>How would you modify these weights to target ATT or ATC?</li>
</ul>
<p><strong>Hint</strong>: multiply by <span class="math inline">\(e(X_i)\)</span> for ATT and by <span class="math inline">\(1 - e(X_i)\)</span> for ATC</p>

</div>
<aside><div>
<p>Following Chattopadhyay, Hase, and Zubizarreta (2020)</p>
</div></aside></section>
<section id="stabilised-and-trimmed-weights" class="slide level2">
<h2>Stabilised and trimmed weights</h2>
<p>When weights in denominator very small, it can blow up and unstabilise the estimator.</p>
<p><strong>Solution 1</strong>: <em>stabilised weights</em></p>
<p>For the ATE, the corresponding stabilised IPWs are:</p>
<p><span class="math display">\[
sw_i = \frac{e(X) D_i}{e(X_i)} + \frac{(1-e(X))(1-D_i)}{1-e(X_i)}
\]</span> where <span class="math inline">\(e(X) = P(Y=1)\)</span>, marginal probability of treatment (sample proportion).</p>
<p>For ATT: <span class="math inline">\(sw_i = 1\)</span> for treated units and <span class="math inline">\(sw_i = \frac{e(X_i)}{1-e(X_i)}\)</span> for coontrol units</p>
<p><strong>Solution 2</strong>: Cap the weights at a min and max value (<em>trimmed weights</em>)</p>
<p><strong>Solution 3</strong>: Drop cases with extreme values (<em>trimmed cases</em>)</p>
<p><strong>Solution 4</strong>: mix solutions 1-3</p>
<p>Note when trimming is used, interpretation of ATT/ATE changes slightly.</p>
</section>
<section id="how-to-weight-with-a-different-scale-entropy-balancing-calibration-weights" class="slide level2">
<h2>How to weight with a different scale: entropy balancing (calibration weights)</h2>
<p>When using propensity score weights, we want to achieve is balance on covariates. So we would:</p>
<ol type="1">
<li><p>estimate a model for <span class="math inline">\(e(X_i)\)</span>;</p></li>
<li><p>invert and and reweight sample;</p></li>
<li><p>check balance;</p></li>
<li><p>re-estimate propensity score if necessary.</p></li>
</ol>
<div class="fragment">
<p>Is that the only way?</p>
<p><span style="color:red"><em>Entropy balancing</em></span> or more generally <span style="color:red"><em>calibration/optimisation</em></span> weights <em>bypass</em> these steps, and directly find weights that exactly (up to a tolerance level) “balance” (moments of) the covariates</p>
<p>If feasible, this will give you balance <span style="color:green"><em>in the sample</em></span></p>
<p>Luckily, we don’t need to do this manually, R can do it for us</p>
</div>
</section>
<section id="balance-and-overlap" class="slide level2">
<h2>Balance and overlap</h2>
<p>Once matching or weigthing is done, one can/should check <span style="color:red"><em>balance</em></span> in X variables by comparing pre- and post- matching and weighting distributions of variables. There should not be systematic differences between the treatment and control group after matching/weighting.</p>
<p><span style="color:red"><em>Overlap or common support</em></span> can/should be checked too. There must be substantial overlap between treatment and control groups re matching variables. This can be checked on covariates or propensity scores.</p>
<p>If common support is not good: <span style="color:red"><em>trim</em></span> (drop cases without common support)</p>
<div class="fragment">
<p>NB: balance and overlap issues are less transparent in regression.</p>
</div>
</section>
<section id="summary-for-matching-and-weighting" class="slide level2">
<h2>Summary for matching and weighting</h2>
<p>Matching and weighting share many common ideas</p>
<p>Most importantly, they all allow for some diagnostics <em>before</em> conducting the outcome analysis: balance testing</p>
<p>Checking balance does not require looking at the outcome, in fact one doesn’t look at the outcome at all during finding matches or weights</p>
<p>This can provide a guidance on the credibility of the results to come</p>
<div class="fragment">
<ul>
<li>This is what Rubin meant by “design triumphs analysis”</li>
</ul>
</div>
<div class="fragment">
<p>But be careful of overly relying on balance checking! (And use best practices, like equivalence testing)</p>
<p>Also, beware of residual imbalance! Modeling the outcome can come handy, as we will see next</p>
</div>
</section></section>
<section>
<section id="augmented-estimators" class="title-slide slide level1 center" data-background-color="#E9004C">
<h1>Augmented estimators</h1>

</section>
<section id="augmented-ipw" class="slide level2">
<h2>Augmented IPW</h2>
<p>Can we get the best of both (regression on the one hand and weighting on the other) worlds? Yes, we can!</p>
<p>Combine balancing (weighting) with outcome modeling (regression) in a single estimator: augmented IPW</p>
<p><span class="math display">\[
\hat{\tau}_{AIPW} = \frac{1}{n}\sum_{i=1}^n \Big( \hat{\mu}(1,X_i) - \hat{\mu}(0,X_i)
+ \frac{D_i}{\hat{e}(X_i)}(Y_i - \hat{\mu}(1,X_i)) - \frac{1-D_i}{1-\hat{e}(X_i)}(Y_i - \hat{\mu}(0,X_i)) \Big)
\]</span> This has the property of <strong>doubly robustness</strong> (DR): the model with be consistent for the treatment effect if either</p>
<ol type="1">
<li><p>the outcome model or,</p></li>
<li><p>the treatment model, are well specified</p></li>
</ol>
<div class="fragment">
<div class="callout callout-tip no-icon callout-titled callout-style-simple">
<div class="callout-body">
<div class="callout-title">
<p><strong>Important</strong></p>
</div>
<div class="callout-content">
<p>The augmented estimator requires the same unconfoundedness assumption! No free lunch</p>
</div>
</div>
</div>
</div>
</section>
<section id="what-about-machine-learning" class="slide level2">
<h2>What about machine learning?</h2>
<p>There are different ways of using machine learning for estimation</p>
<ul>
<li><p>Flexible model of the outcome + imputation</p></li>
<li><p>Flexible model of the treatment + weighting</p></li>
<li><p>Or combibine both: <strong>Double/debiased ML</strong></p></li>
</ul>
<p>*Double/Debiased Machine Learning (DML): similar to doubly robust IPW estimator but the outcome and selection are predicted using ML</p>
<ul>
<li>DML works in three steps:</li>
</ul>
<ol type="1">
<li><p>Predict outcome <span class="math inline">\(Y\)</span> with ML using covariates (e.g.&nbsp;LASSO/forest …) and obtain residuals <span class="math inline">\(Y-\widehat{Y}\)</span></p></li>
<li><p>Predict treatment <span class="math inline">\(D\)</span> with ML using covariates (e.g.&nbsp;LASSO/forest …) and obtain residuals <span class="math inline">\(D-\widehat{D}\)</span></p></li>
<li><p>Regress (<span class="math inline">\(Y-\widehat{Y}\)</span>) on (<span class="math inline">\(D-\widehat{D}\)</span>) for the doubly robust DML estimate</p></li>
</ol>
</section>
<section id="wrap-up" class="slide level2">
<h2>Wrap up</h2>
<ul>
<li>We looked at four ways of closing backdoors in simple confounding models
<ol type="1">
<li>Regression</li>
<li>Matching</li>
<li>Weighting</li>
<li>Augmented estimators (doubly robust IPW and double/debiased machine learning)</li>
</ol></li>
<li>What should we do in practice?</li>
</ul>
<p>Well, no approach is superior. Use a combination of approaches.</p>
<ul>
<li><p>Regression is easy so do it even as robustness check.</p></li>
<li><p>If treatment is binary, IPW or entropy balancing weighting is probably advisable vis-a-vis matching, for the latter has many researcher degrees of freedom.</p></li>
<li><p>Try augmented estimators and double ML when you have <strong>many (!)</strong> confounders, interactions, or nonlinearities AND <strong>large</strong> dataset.</p></li>
</ul>
<p>Hands-on-exercises of this week treats these.</p>
</section>
<section id="remember-regression-matching-weighting-doubly-robust-estimation-double-machine-learning-or-however-fancy-sounding-method-of-selection-on-observables-are-not-identification-strategies" class="slide level2">
<h2>Remember: Regression, matching, weighting, doubly robust estimation, double machine learning or however fancy sounding method of selection on observables are NOT identification strategies!</h2>
<p>Identification comes from design, model, and extra-statistical assumptions, not from the estimator!</p>

</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="https://fundit.fr/sites/default/files/styles/max_650x650/public/institutions/oxford.png?itok=yBrBnRnK" class="slide-logo"></p>
<div class="footer footer-default">
<p>Why Causal Inference?</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="3.lecture3.blocking.bdoors_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="3.lecture3.blocking.bdoors_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 1000,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>